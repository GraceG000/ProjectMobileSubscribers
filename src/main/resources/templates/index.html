<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width-device-width, initial-scale=1.0">
    <title>Mobile Subscribers</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{/js/css/main.css}">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>

    <style>

        a{
            color:white;
        }

    </style>
</head>
<body>

<ul>
    <li><a class="active" th:href="@{/AllNumbers}">Home Backend-Pag</a></li>
    <li><a th:href="@{/AllNumbersDT}">Home Frontend-Pag</a></li>
    <li><a th:href="@{/stats}">Statistics</a></li>
</ul>

<div class = "container mt-3">

<h1>Welcome to Mobile Subscribers</h1>
<br>

        <a th:href="@{/page/addon2}" class="btn btn-primary btn-sm mb-3" >Add Subscriber</a>

    <div class = "row container mt-3 pagination">
        <div class="col-md-5" align="left">
            Show entries
            <label>
                <select name="pageSize" aria-controls="example" class="form-select form-select-sm" id = "pageSizeSelect" th:data-href="@{'/page/1?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+ '&keyword='+${keyword}}">
                    <option value="10" th:selected="${pageSize==10}">10</option>
                    <option value="25" th:selected="${pageSize==25}">25</option>
                    <option value="50" th:selected="${pageSize==50}">50</option>
                    <option value="100" th:selected="${pageSize==100}">100</option>
                </select>
            </label>
        </div>
    <div class="pagination" align="right">
        <form th:action="@{/page/1}" method = "get" >
            <label>
               <input type ="text" name="keyword" th:value="${keyword}" placeholder="Type here" class="form-control-sm" size = "30" style="padding:5px" >
            </label>

            <button type="submit" class="btn btn-info">Search</button>
            <a th:href="@{/AllNumbers}" class="btn btn-info">Reset</a>
        </form>
    </div>
        <br>
    </div>

    <div class="table">
        <!--Making the entire table a form, so that we can use javascript to implement a safe-delete feature...-->
        <form th:action="@{/delete/}" method="get" id="delete-form">
            <table id="example" class = "table table-striped table-bordered table-hover" style="width:100%">
                <thead  class="table-dark">
                <tr>
                    <th>
                        <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=id&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}">Id
                         <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                         <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                        </a>
                        </span>
                    </th>
                    <th>
                       <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=customerIdOwner&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}" >Customer Owner Id
                        <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                        <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                       </a>
                       </span>
                    </th>
                    <th>
                        <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=customerIdUser&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}">Customer User Id
                        <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                        <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                        </a>
                        </span>
                    </th>
                    <th>
                        <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=msisdn&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}">Msisdn
                        <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                        <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                        </a>
                        </span>
                    </th>
                    <th>
                        <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=serviceStartDate&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}">Service Start Date
                         <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                         <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                        </a>
                        </span>
                    </th>
                    <th>
                        <span><a th:href="@{'/page/' + ${currentPage} + '?sortField=serviceType&sortDir=' + ${reverseSortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}">Service Type
                        <i class="fa fa-sort-asc sort-color d-flex-column" style="float:right;"}></i>
                        <i class="fa fa-sort-desc sort-color d-flex-column" style="float:right;"}></i>
                        </a>
                        </span></th>
                    <th>Action</th>
                </tr>
                </thead>
                <tbody>

                    <tr th:each ="subscribers:${subs}">

                        <td th:text="${subscribers.id}"></td>
                        <td th:text="${subscribers.customerIdOwner}"></td>
                        <td th:text="${subscribers.customerIdUser}"></td>
                        <td th:text="${subscribers.msisdn}"></td>
                        <td th:text="${subscribers.serviceStartDate}"></td>
                        <td th:text="${subscribers.serviceType}"></td>
                        <td>
                            <a th:href="@{/updatePage/{id}(id=${subscribers.id})}" class= "btn btn-primary">Edit</a>
                            <!--                    <a th:href="@{/delete/{id}(id=${subscribers.id})}"  class= "btn btn-danger" onclick="myFunction(e)">Delete</a>-->
                            <button type="button" th:data-href="${subscribers.id}"  class= "btn btn-danger delete_btn" >Delete</button>
                        </td>
                    </tr>

                </tbody>
            </table>
        </form>
    </div>

</div>
   <div th:if = "${totalPages > 0}" class = "container mt-3 pagination-container">

       <div>
           Showing number of entries: [[${totalItems}]]
       </div>

       <div th:if = "${totalPages > 0}" class = "pagination" align="right" >
          <a th:if="${currentPage !=1}" th:href="@{'/page/' + ${currentPage - 1}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}"  class="btn btn-primary btn-sm mb-3">Previous</a>
          <span th:unless="${currentPage < totalPages}" ></span>

       <span th:each="i: ${#numbers.sequence(1, totalPages)}">
           <a th:if="${currentPage != i}" th:href="@{'/page/' + ${i}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}" class="btn btn-primary btn-sm mb-3 ">[[${i}]]</a>
           <span th:if="${currentPage == i}" class="btn btn-primary btn-sm mb-3 highlight">[[${i}]]</span>
      </span>

      <a th:if="${currentPage < totalPages}" th:href="@{'/page/' + ${currentPage + 1}+ '?sortField=' + ${sortField} + '&sortDir=' + ${sortDir}+ '&keyword='+${keyword}+'&pageSize=' +${pageSize}}" class="btn btn-primary btn-sm mb-3">Next</a>
      <span th:unless="${currentPage > totalPages}" ></span>

     </div>

   </div>

   <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<!--The scripts below are for implementing page sizing and safe-delete...-->
    <script th:inline="javascript">
        $(document).ready(() => {
            changePageAndSize();
            /*Whenever the button is clicked, it will call function(e)...*/
            $(".delete_btn").click(function(e){
                myFunction(e);
            })
        });

        changePageAndSize = () => {
            $('#pageSizeSelect').change(evt => {
                let sizeStr = `&pageSize=${evt.target.value}`;
                let ele = document.querySelector("#pageSizeSelect");
                /*let ele2 = $('#pageSizeSelect');
                console.log("Vanilla JS : ", ele.getAttribute("data-href") , "\nJQuery : ", ele2[0].attributes["data-href"]);*/
                window.location.href = ele.getAttribute("data-href") + sizeStr;
            });
        }

        function myFunction(e) {

            var txt;
            if (confirm("Are you sure you want to delete?")==true) {
                txt = "You are deleting the subscriber information!";
                let del = document.querySelector("#delete-form");

                let impl = $(e.target).attr('data-href');
                let new_action = del.getAttribute("action") + impl;
                del.setAttribute('action', new_action);
                // $("#delete-form").attr('action', new_action);
                $("#delete-form").submit();
            } else {
                txt = "You pressed Cancel!"
            }
            console.log(txt);
        }
        /*window.myFunction = myFunction;*/

    </script>
 </body>
 </html>
